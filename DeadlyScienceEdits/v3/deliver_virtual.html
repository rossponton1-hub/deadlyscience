<!doctype html>
<html lang="en-AU">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Deliver Session (Virtual) – DeadlyScience v3</title>
  <style>
    :root {--ink:#0f172a;--charcoal:#1f2937;--muted:#6b7280;--bg:#eef2ff;--white:#ffffff;--line:#c7d2fe;--violet:#6366f1;--emerald:#047857;--rose:#dc2626;--amber:#fbbf24;}
    body {margin:0;font-family:'Inter',system-ui,-apple-system,Segoe UI,Roboto,sans-serif;background:var(--bg);color:var(--charcoal);} 
    header {background:var(--white);border-bottom:1px solid var(--line);padding:24px;} 
    main {padding:24px;max-width:960px;margin:0 auto;} 
    h1 {margin:0;font-size:28px;font-weight:700;color:var(--ink);} 
    p.lead {color:var(--muted);margin:4px 0 0 0;} 
    .card {background:var(--white);border:1px solid var(--line);border-radius:20px;padding:24px;margin-bottom:24px;box-shadow:0 12px 32px rgba(79,70,229,0.1);} 
    .school-list {display:grid;gap:16px;} 
    .school-card {border:1px solid var(--line);border-radius:18px;padding:20px;display:flex;flex-direction:column;gap:12px;} 
    .school-header {display:flex;justify-content:space-between;align-items:center;gap:12px;} 
    .school-name {font-size:18px;font-weight:700;color:var(--ink);} 
    .status-row {display:flex;flex-wrap:wrap;gap:8px;} 
    .status-chip {display:inline-flex;align-items:center;gap:6px;padding:6px 12px;border-radius:999px;border:1px solid var(--line);font-size:12px;font-weight:600;} 
    .tone-success {background:rgba(4,120,87,0.12);border-color:rgba(4,120,87,0.3);} 
    .tone-warn {background:rgba(251,191,36,0.18);border-color:rgba(251,191,36,0.4);} 
    .tone-danger {background:rgba(220,38,38,0.12);border-color:rgba(220,38,38,0.3);} 
    .tone-info {background:rgba(99,102,241,0.16);border-color:rgba(99,102,241,0.4);} 
    button.primary {background:var(--violet);color:#fff;border:0;border-radius:12px;padding:12px 16px;font-weight:600;cursor:pointer;} 
    button.secondary {background:var(--white);color:var(--charcoal);border:1px solid var(--line);border-radius:12px;padding:12px 16px;font-weight:600;cursor:pointer;} 
    button.danger {background:var(--rose);color:#fff;border:0;border-radius:12px;padding:12px 16px;font-weight:600;cursor:pointer;} 
    .tooltip {position:relative;display:inline-flex;align-items:center;justify-content:center;width:18px;height:18px;border-radius:50%;background:var(--ink);color:#fff;font-size:11px;cursor:help;} 
    .tooltip::after {content:attr(data-tooltip);position:absolute;left:50%;transform:translate(-50%,12px);bottom:-4px;background:var(--ink);color:#fff;padding:8px 12px;border-radius:8px;font-size:12px;line-height:1.3;width:220px;opacity:0;pointer-events:none;transition:opacity .2s;z-index:20;} 
    .tooltip:hover::after {opacity:1;} 
    .filter-shell {background:var(--white);border:1px solid var(--line);border-radius:20px;padding:16px;margin:16px 0;box-shadow:0 6px 18px rgba(79,70,229,0.12);} 
    .filter-heading {display:flex;align-items:center;gap:8px;font-weight:600;margin-bottom:12px;color:var(--ink);} 
    .chip-row {display:flex;flex-wrap:wrap;gap:8px;} 
    .chip {display:inline-flex;align-items:center;gap:6px;background:var(--bg);border:1px solid var(--line);border-radius:999px;padding:6px 14px;font-weight:600;font-size:13px;color:var(--charcoal);cursor:pointer;} 
    .chip.active {background:var(--violet);color:#fff;border-color:var(--violet);} 
    .custom-range {display:none;margin-top:12px;} 
    .custom-range.active {display:block;} 
    .custom-inputs {display:flex;gap:12px;flex-wrap:wrap;} 
    .demographic-grid {display:grid;grid-template-columns:repeat(auto-fit,minmax(180px,1fr));gap:12px;} 
    input[type="number"], input[type="text"] {padding:12px;border-radius:12px;border:1px solid var(--line);font-size:14px;width:100%;} 
  </style>
</head>
<body>
  <header>
    <h1>Deliver Session – Virtual</h1>
    <p class="lead">Teacher-led submission with aligned closure codes and reminder milestones.</p>
  </header>
  <main>
    <section id="UniversalFilters"></section>

    <article class="card">
      <h2 style="margin-top:0;">Coordinator Tools</h2>
      <p class="lead">Demographics_Source__c defaults to Teacher_Link. Reminders stop once Submitted or Wont_Submit.</p>
      <div class="status-row" id="VirtualLifecycleChips"></div>
    </article>

    <article class="card">
      <h2 style="margin-top:0;">Schools Awaiting Submission</h2>
      <div class="school-list" id="VirtualSchoolList"></div>
    </article>
  </main>

  <script src="config/universal.js"></script>
  <script>
    const virtualSchools = [
      {name:'Thursday Island State School', status:'Scheduled', demographics:'Pending', reminders:['T+1 pending','T+3 pending'], program:'DeadlyLabs', lastContact:'2025-02-10'},
      {name:'Yirrkala School', status:'Delivered', demographics:'Reminded', reminders:['T+1 sent','T+3 scheduled'], program:'MarineScience', lastContact:'2025-02-05'},
      {name:'Cherbourg State School', status:'Delivered', demographics:'Not_Applicable', reminders:['Not required'], program:'Robotics', lastContact:'2025-01-29'}
    ];

    let virtualConfig;

    document.addEventListener('DOMContentLoaded', async () => {
      virtualConfig = await renderUniversalDateFilter('UniversalFilters', {defaultPreset:'Last_7_Days'});
      const lifecycle = document.getElementById('VirtualLifecycleChips');
      virtualConfig.sessionSchoolStatus.forEach(value => {
        const tone = value === 'Delivered' ? 'success' : value === 'Cancelled' ? 'danger' : 'warn';
        lifecycle.appendChild(createStatusChip(value, 'Closure codes align with Session_School__c.Status__c.', tone));
      });
      lifecycle.appendChild(createStatusChip('Demographics_Source__c = Teacher_Link', 'Virtual sessions rely on teacher completion.', 'info'));

      renderVirtualSchools();
    });

    function renderVirtualSchools() {
      const container = document.getElementById('VirtualSchoolList');
      container.innerHTML = '';
      virtualSchools.forEach((school, index) => {
        const card = document.createElement('div');
        card.className = 'school-card';

        const header = document.createElement('div');
        header.className = 'school-header';
        const title = document.createElement('div');
        title.className = 'school-name';
        title.textContent = school.name;
        const statusRow = document.createElement('div');
        statusRow.className = 'status-row';
        statusRow.appendChild(createStatusChip(school.status, 'Session__c.Status__c context for teachers.', school.status === 'Delivered' ? 'success' : 'info'));
        statusRow.appendChild(createStatusChip(`Demographics: ${school.demographics}`, 'Demographics_Status__c shared with in-person capture.', school.demographics === 'Submitted' ? 'success' : school.demographics === 'Wont_Submit' ? 'danger' : school.demographics === 'Not_Applicable' ? 'info' : 'warn'));
        header.appendChild(title);
        header.appendChild(statusRow);

        const body = document.createElement('div');
        body.style.display = 'flex';
        body.style.flexDirection = 'column';
        body.style.gap = '12px';
        const metrics = document.createElement('div');
        metrics.className = 'demographic-grid';
        metrics.innerHTML = `
          <label>Total_Students__c<input type="number" value="" placeholder="Leave blank until submitted" /></label>
          <label>ATSI_Students__c<input type="number" value="" placeholder="Complete via teacher form" /></label>
          <label>Year_Levels__c<input type="text" value="" placeholder="Supplied by teacher" /></label>
        `;

        const actions = document.createElement('div');
        actions.style.display = 'flex';
        actions.style.flexWrap = 'wrap';
        actions.style.gap = '8px';

        const resend = document.createElement('button');
        resend.className = 'primary';
        resend.textContent = 'Send/Resend teacher link';
        resend.addEventListener('click', () => updateVirtualStatus(index, 'Reminded'));

        const wont = document.createElement('button');
        wont.className = 'secondary';
        wont.textContent = 'Mark Wont_Submit';
        wont.addEventListener('click', () => updateVirtualStatus(index, 'Wont_Submit'));

        const notApplicable = document.createElement('button');
        notApplicable.className = 'secondary';
        notApplicable.textContent = 'Mark Not_Applicable';
        notApplicable.addEventListener('click', () => updateVirtualStatus(index, 'Not_Applicable'));

        const submit = document.createElement('button');
        submit.className = 'primary';
        submit.textContent = 'Submit demographics';
        submit.addEventListener('click', () => updateVirtualStatus(index, 'Submitted'));

        actions.appendChild(resend);
        actions.appendChild(submit);
        actions.appendChild(wont);
        actions.appendChild(notApplicable);

        const reminderInfo = document.createElement('div');
        reminderInfo.style.color = 'var(--muted)';
        reminderInfo.style.fontSize = '13px';
        reminderInfo.textContent = `Reminder cadence: ${school.reminders.join(' / ')}`;

        const lastContact = document.createElement('div');
        lastContact.style.color = 'var(--muted)';
        lastContact.style.fontSize = '13px';
        lastContact.textContent = `Last outreach: ${school.lastContact}`;

        body.appendChild(metrics);
        body.appendChild(actions);
        body.appendChild(reminderInfo);
        body.appendChild(lastContact);

        card.appendChild(header);
        card.appendChild(body);
        container.appendChild(card);
      });
    }

    function updateVirtualStatus(index, status) {
      virtualSchools[index].demographics = status;
      if (status === 'Submitted' || status === 'Wont_Submit' || status === 'Not_Applicable') {
        virtualSchools[index].reminders = ['Reminders stopped'];
      } else if (status === 'Reminded') {
        virtualSchools[index].reminders = ['T+1 sent','T+3 scheduled'];
      }
      renderVirtualSchools();
    }
  </script>
</body>
</html>
